<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LumenosPhys Premium Subscription</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Yoco SDK -->
    <script src="https://js.yoco.com/sdk/v1/yoco-sdk-web.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Navigation -->
        <nav class="bg-blue-800 shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <a href="/" class="flex items-center">
                            <span class="text-white text-xl font-bold">LumenosPhys</span>
                        </a>
                    </div>
                    <div class="flex items-center">
                        <span id="userEmail" class="text-white mr-4"></span>
                        <button id="logoutBtn" class="text-white hover:text-gray-200">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <!-- Current Plan Status -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Your Current Plan</h2>
                        <p id="currentPlanStatus" class="mt-1 text-sm text-gray-500">Loading...</p>
                    </div>
                    <div class="flex items-center">
                        <span id="trialBadge" class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full hidden">
                            Trial Active
                        </span>
                    </div>
                </div>
            </div>

            <!-- Subscription Plans -->
            <div class="space-y-12 lg:space-y-0 lg:grid lg:grid-cols-3 lg:gap-x-8">
                <!-- Basic Plan -->
                <div class="relative p-8 bg-white border border-gray-200 rounded-2xl shadow-sm flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold text-gray-900">Basic</h3>
                        <p class="mt-4 flex items-baseline text-gray-900">
                            <span class="text-5xl font-bold tracking-tight">Free</span>
                            <span class="ml-1 text-xl font-semibold">/forever</span>
                        </p>
                        <p class="mt-6 text-gray-500">Basic physics simulations for everyone.</p>

                        <ul role="list" class="mt-6 space-y-6">
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">Newton's Laws Simulations</span>
                            </li>
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">Basic Tutorial Content</span>
                            </li>
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">Community Support</span>
                            </li>
                        </ul>
                    </div>
                    <button class="mt-8 block w-full bg-gray-200 text-gray-600 rounded-md py-2 text-sm font-semibold text-center" disabled>
                        Current Plan
                    </button>
                </div>

                <!-- Premium Monthly Plan -->
                <div class="relative p-8 bg-white border border-gray-200 rounded-2xl shadow-sm flex flex-col">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold text-gray-900">Premium Monthly</h3>
                        <p class="mt-4 flex items-baseline text-gray-900">
                            <span class="text-5xl font-bold tracking-tight">R399</span>
                            <span class="ml-1 text-xl font-semibold">/month</span>
                        </p>
                        <p class="mt-6 text-gray-500">Advanced simulations and premium features.</p>

                        <ul role="list" class="mt-6 space-y-6">
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">All Basic Features</span>
                            </li>
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">Advanced Simulations</span>
                            </li>
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">Priority Support</span>
                            </li>
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">Interactive Exercises</span>
                            </li>
                        </ul>
                    </div>
                    <button id="monthlySubscribeBtn" class="mt-8 block w-full bg-blue-800 text-white rounded-md py-2 text-sm font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2">
                        Subscribe Monthly
                    </button>
                </div>

                <!-- Premium Annual Plan -->
                <div class="relative p-8 bg-white border border-gray-200 rounded-2xl shadow-sm flex flex-col">
                    <div class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/2">
                        <span class="inline-flex rounded-full bg-green-100 px-4 py-1 text-xs font-semibold text-green-600">
                            Save 20%
                        </span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold text-gray-900">Premium Annual</h3>
                        <p class="mt-4 flex items-baseline text-gray-900">
                            <span class="text-5xl font-bold tracking-tight">R3,828</span>
                            <span class="ml-1 text-xl font-semibold">/year</span>
                        </p>
                        <p class="mt-6 text-gray-500">Best value for committed learners.</p>

                        <ul role="list" class="mt-6 space-y-6">
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">All Premium Monthly Features</span>
                            </li>
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">20% Annual Discount</span>
                            </li>
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">Offline Access</span>
                            </li>
                            <li class="flex">
                                <i class="fas fa-check flex-shrink-0 text-green-500"></i>
                                <span class="ml-3 text-gray-500">Premium Support</span>
                            </li>
                        </ul>
                    </div>
                    <button id="annualSubscribeBtn" class="mt-8 block w-full bg-blue-800 text-white rounded-md py-2 text-sm font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2">
                        Subscribe Annually
                    </button>
                </div>
            </div>

            <!-- Payment Processing Modal -->
            <div id="paymentModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center">
                <div class="bg-white p-8 rounded-lg shadow-lg w-96 max-w-md">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Complete Payment</h3>
                        <button id="closePaymentModal" class="text-gray-400 hover:text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="payment-form" class="space-y-4">
                        <!-- Yoco Inline Form will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-50 mt-12">
            <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                <div class="mt-8 border-t border-gray-200 pt-8 md:flex md:items-center md:justify-between">
                    <div class="flex space-x-6 md:order-2">
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <span class="sr-only">Terms</span>
                            Terms of Service
                        </a>
                        <a href="#" class="text-gray-400 hover:text-gray-500">
                            <span class="sr-only">Privacy</span>
                            Privacy Policy
                        </a>
                    </div>
                    <p class="mt-8 text-base text-gray-400 md:mt-0 md:order-1">
                        &copy; 2024 LumenosPhys. All rights reserved.
                    </p>
                </div>
            </div>
        </footer>
    </div>
    <script>
      // Initialize Yoco
const yoco = new window.Yoco({
    publicKey: 'pk_test_464a83a4rr5mqEM5dc44'  // Replace with your actual public key
});

// DOM Elements
const elements = {
    userEmail: document.getElementById('userEmail'),
    logoutBtn: document.getElementById('logoutBtn'),
    currentPlanStatus: document.getElementById('currentPlanStatus'),
    trialBadge: document.getElementById('trialBadge'),
    monthlySubscribeBtn: document.getElementById('monthlySubscribeBtn'),
    annualSubscribeBtn: document.getElementById('annualSubscribeBtn'),
    paymentModal: document.getElementById('paymentModal'),
    closePaymentModal: document.getElementById('closePaymentModal'),
    paymentForm: document.getElementById('payment-form')
};

// Subscription Plans Configuration
const SUBSCRIPTION_PLANS = {
    MONTHLY: {
        id: 'premium-monthly',
        price: 39900, // In cents (R399.00)
        name: 'Premium Monthly'
    },
    ANNUAL: {
        id: 'premium-annual',
        price: 382800, // In cents (R3,828.00)
        name: 'Premium Annual'
    }
};

// Current user and subscription state
let currentUser = null;
let currentSubscription = null;

// Authentication state observer
function initializeAuth() {
    // Simulated auth state change listener
    // Replace with your actual auth implementation
    const user = localStorage.getItem('user');
    if (user) {
        currentUser = JSON.parse(user);
        updateUIWithUser(currentUser);
        fetchSubscriptionStatus();
    } else {
        window.location.href = '/login';
    }
}

// Update UI with user information
function updateUIWithUser(user) {
    elements.userEmail.textContent = user.email;
}

// Fetch current subscription status
async function fetchSubscriptionStatus() {
    try {
        // Simulate API call - replace with actual endpoint
        const response = await fetch('/api/subscription-status', {
            headers: {
                'Authorization': `Bearer ${currentUser.token}`
            }
        });
        
        if (!response.ok) throw new Error('Failed to fetch subscription status');
        
        const subscription = await response.json();
        currentSubscription = subscription;
        updateSubscriptionUI(subscription);
    } catch (error) {
        console.error('Error fetching subscription:', error);
        elements.currentPlanStatus.textContent = 'Error loading subscription status';
    }
}

// Update UI based on subscription status
function updateSubscriptionUI(subscription) {
    if (!subscription || subscription.status === 'inactive') {
        elements.currentPlanStatus.textContent = 'Free Plan';
        elements.trialBadge.classList.add('hidden');
    } else {
        elements.currentPlanStatus.textContent = `${subscription.plan} (${subscription.status})`;
        if (subscription.trial) {
            elements.trialBadge.classList.remove('hidden');
        }
    }
}

// Handle subscription button clicks
async function handleSubscription(planType) {
    const plan = SUBSCRIPTION_PLANS[planType];
    showPaymentModal();
    await initializePaymentForm(plan);
}

// Show payment modal
function showPaymentModal() {
    elements.paymentModal.classList.remove('hidden');
    elements.paymentModal.classList.add('flex');
}

// Hide payment modal
function hidePaymentModal() {
    elements.paymentModal.classList.remove('flex');
    elements.paymentModal.classList.add('hidden');
    elements.paymentForm.innerHTML = ''; // Clear the form
}

// Initialize Yoco payment form
async function initializePaymentForm(plan) {
    elements.paymentForm.innerHTML = `
        <div class="mb-4">
            <h4 class="text-lg font-medium text-gray-900">${plan.name}</h4>
            <p class="text-gray-500">R${(plan.price / 100).toFixed(2)}</p>
        </div>
        <div id="card-frame"></div>
        <button id="pay-button" class="mt-4 w-full bg-blue-800 text-white rounded-md py-2 text-sm font-semibold hover:bg-blue-700">
            Pay Now
        </button>
    `;

    const cardFrame = yoco.inline({
        layout: 'basic',
        amountInCents: plan.price,
        currency: 'ZAR'
    });
    cardFrame.mount('#card-frame');

    document.getElementById('pay-button').addEventListener('click', async () => {
        try {
            const result = await cardFrame.createToken();
            await processPayment(result.token, plan);
        } catch (error) {
            console.error('Payment error:', error);
            alert(error.message);
        }
    });
}

// Process payment and create subscription
async function processPayment(token, plan) {
    try {
        // Simulate API call - replace with actual endpoint
        const response = await fetch('/api/create-subscription', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${currentUser.token}`
            },
            body: JSON.stringify({
                token,
                planId: plan.id,
                amount: plan.price
            })
        });

        if (!response.ok) throw new Error('Payment failed');

        const result = await response.json();
        hidePaymentModal();
        alert('Subscription successful!');
        await fetchSubscriptionStatus(); // Refresh subscription status
    } catch (error) {
        console.error('Payment processing error:', error);
        alert('Payment failed: ' + error.message);
    }
}

// Handle logout
function handleLogout() {
    // Simulate logout - replace with actual logout logic
    localStorage.removeItem('user');
    window.location.href = '/login';
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
    initializeAuth();
    
    elements.monthlySubscribeBtn.addEventListener('click', () => 
        handleSubscription('MONTHLY')
    );
    
    elements.annualSubscribeBtn.addEventListener('click', () => 
        handleSubscription('ANNUAL')
    );
    
    elements.closePaymentModal.addEventListener('click', hidePaymentModal);
    
    elements.logoutBtn.addEventListener('click', handleLogout);
    
    // Close modal when clicking outside
    elements.paymentModal.addEventListener('click', (e) => {
        if (e.target === elements.paymentModal) {
            hidePaymentModal();
        }
    });
});

// Handle errors gracefully
window.addEventListener('error', (event) => {
    console.error('Global error:', event.error);
    alert('An unexpected error occurred. Please try again.');
});
    </script>
</body>
</html>
